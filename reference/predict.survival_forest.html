<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Predict with a survival forest — predict.survival_forest • grf</title>

<!-- favicons -->
<link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png" />
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png" />
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png" />
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png" />

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>



  
  <script src="../extra.js"></script>

<meta property="og:title" content="Predict with a survival forest — predict.survival_forest" />
<meta property="og:description" content="Gets estimates of the conditional survival function S(t, x) using a trained survival forest. The curve can be
estimated by Kaplan-Meier, or Nelson-Aalen." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">grf</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">2.0.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../articles/grf.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Tutorials
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/categorical_inputs.html">Categorical inputs</a>
    </li>
    <li>
      <a href="../articles/ci_and_num.trees.html">Confidence intervals and the number of trees</a>
    </li>
    <li>
      <a href="../articles/muhats.html">Estimating conditional means</a>
    </li>
    <li>
      <a href="../articles/diagnostics.html">Evaluating a causal forest fit</a>
    </li>
    <li>
      <a href="../articles/llf.html">Local linear forests</a>
    </li>
    <li>
      <a href="../articles/policy_learning.html">Policy learning</a>
    </li>
    <li>
      <a href="../articles/sample_weighting_examples.html">Sample weighting</a>
    </li>
    <li>
      <a href="../articles/visualize_tree.html">Visualize trees</a>
    </li>
  </ul>
</li>
<li>
  <a href="../REFERENCE.html">Algorithm reference</a>
</li>
<li>
  <a href="../DEVELOPING.html">Developing</a>
</li>
<li>
  <a href="../CHANGELOG.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/grf-labs/grf">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Predict with a survival forest</h1>
    <small class="dont-index">Source: <a href='https://github.com/grf-labs/grf/blob/master/R/survival_forest.R'><code>R/survival_forest.R</code></a></small>
    <div class="hidden name"><code>predict.survival_forest.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Gets estimates of the conditional survival function S(t, x) using a trained survival forest. The curve can be
estimated by Kaplan-Meier, or Nelson-Aalen.</p>
    </div>

    <pre class="usage"><span class='co'># S3 method for survival_forest</span>
<span class='fu'><a href='https://rdrr.io/r/stats/predict.html'>predict</a></span>(
  <span class='no'>object</span>,
  <span class='kw'>newdata</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>failure.times</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>prediction.type</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"Kaplan-Meier"</span>, <span class='st'>"Nelson-Aalen"</span>),
  <span class='kw'>num.threads</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='no'>...</span>
)</pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>object</th>
      <td><p>The trained forest.</p></td>
    </tr>
    <tr>
      <th>newdata</th>
      <td><p>Points at which predictions should be made. If NULL, makes out-of-bag
predictions on the training set instead (i.e., provides predictions at
Xi using only trees that did not use the i-th training example). Note
that this matrix should have the number of columns as the training
matrix, and that the columns must appear in the same order.</p></td>
    </tr>
    <tr>
      <th>failure.times</th>
      <td><p>A vector of failure times to make predictions at. If NULL, then the
failure times used for training the forest is used. The time points should be in increasing order. Default is NULL.</p></td>
    </tr>
    <tr>
      <th>prediction.type</th>
      <td><p>The type of estimate of the survival function, choices are "Kaplan-Meier" or "Nelson-Aalen".
The default is the prediction.type used to train the forest.</p></td>
    </tr>
    <tr>
      <th>num.threads</th>
      <td><p>Number of threads used in training. If set to NULL, the software
automatically selects an appropriate amount.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>Additional arguments (currently ignored).</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>A list with elements `failure.times`: a vector of event times t for the survival curve,
 and `predictions`: a matrix of survival curves. Each row is the survival curve for
 sample X_i: predictions[i, j] = S(failure.times[j], X_i).</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'># \donttest{</span>
<span class='co'># Train a standard survival forest.</span>
<span class='no'>n</span> <span class='kw'>&lt;-</span> <span class='fl'>2000</span>
<span class='no'>p</span> <span class='kw'>&lt;-</span> <span class='fl'>5</span>
<span class='no'>X</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span>(<span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span>(<span class='no'>n</span> * <span class='no'>p</span>), <span class='no'>n</span>, <span class='no'>p</span>)
<span class='no'>failure.time</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/Log.html'>exp</a></span>(<span class='fl'>0.5</span> * <span class='no'>X</span>[, <span class='fl'>1</span>]) * <span class='fu'><a href='https://rdrr.io/r/stats/Exponential.html'>rexp</a></span>(<span class='no'>n</span>)
<span class='no'>censor.time</span> <span class='kw'>&lt;-</span> <span class='fl'>2</span> * <span class='fu'><a href='https://rdrr.io/r/stats/Exponential.html'>rexp</a></span>(<span class='no'>n</span>)
<span class='no'>Y</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>pmin</a></span>(<span class='no'>failure.time</span>, <span class='no'>censor.time</span>)
<span class='no'>D</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/integer.html'>as.integer</a></span>(<span class='no'>failure.time</span> <span class='kw'>&lt;=</span> <span class='no'>censor.time</span>)
<span class='no'>s.forest</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='survival_forest.html'>survival_forest</a></span>(<span class='no'>X</span>, <span class='no'>Y</span>, <span class='no'>D</span>)

<span class='co'># Predict using the forest.</span>
<span class='no'>X.test</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span>(<span class='fl'>0</span>, <span class='fl'>3</span>, <span class='no'>p</span>)
<span class='no'>X.test</span>[, <span class='fl'>1</span>] <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq</a></span>(-<span class='fl'>2</span>, <span class='fl'>2</span>, <span class='kw'>length.out</span> <span class='kw'>=</span> <span class='fl'>3</span>)
<span class='no'>s.pred</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/predict.html'>predict</a></span>(<span class='no'>s.forest</span>, <span class='no'>X.test</span>)

<span class='co'># Plot the survival curve.</span>
<span class='fu'><a href='https://rdrr.io/r/base/plot.html'>plot</a></span>(<span class='fl'>NA</span>, <span class='fl'>NA</span>, <span class='kw'>xlab</span> <span class='kw'>=</span> <span class='st'>"failure time"</span>, <span class='kw'>ylab</span> <span class='kw'>=</span> <span class='st'>"survival function"</span>,
     <span class='kw'>xlim</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/range.html'>range</a></span>(<span class='no'>s.pred</span>$<span class='no'>failure.times</span>),
     <span class='kw'>ylim</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>0</span>, <span class='fl'>1</span>))</div><div class='input'><span class='kw'>for</span>(<span class='no'>i</span> <span class='kw'>in</span> <span class='fl'>1</span>:<span class='fl'>3</span>) {
  <span class='fu'><a href='https://rdrr.io/r/graphics/lines.html'>lines</a></span>(<span class='no'>s.pred</span>$<span class='no'>failure.times</span>, <span class='no'>s.pred</span>$<span class='no'>predictions</span>[<span class='no'>i</span>,], <span class='kw'>col</span> <span class='kw'>=</span> <span class='no'>i</span>)
  <span class='no'>s.true</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/Log.html'>exp</a></span>(-<span class='no'>s.pred</span>$<span class='no'>failure.times</span> / <span class='fu'><a href='https://rdrr.io/r/base/Log.html'>exp</a></span>(<span class='fl'>0.5</span> * <span class='no'>X.test</span>[<span class='no'>i</span>, <span class='fl'>1</span>]))
  <span class='fu'><a href='https://rdrr.io/r/graphics/lines.html'>lines</a></span>(<span class='no'>s.pred</span>$<span class='no'>failure.times</span>, <span class='no'>s.true</span>, <span class='kw'>col</span> <span class='kw'>=</span> <span class='no'>i</span>, <span class='kw'>lty</span> <span class='kw'>=</span> <span class='fl'>2</span>)
}</div><div class='img'><img src='predict.survival_forest-1.png' alt='' width='700' height='433' /></div><div class='input'>
<span class='co'># Predict on out-of-bag training samples.</span>
<span class='no'>s.pred</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/predict.html'>predict</a></span>(<span class='no'>s.forest</span>)

<span class='co'># Plot the survival curve for the first five individuals.</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/matplot.html'>matplot</a></span>(<span class='no'>s.pred</span>$<span class='no'>failure.times</span>, <span class='fu'><a href='https://rdrr.io/r/base/t.html'>t</a></span>(<span class='no'>s.pred</span>$<span class='no'>predictions</span>[<span class='fl'>1</span>:<span class='fl'>5</span>, ]),
        <span class='kw'>xlab</span> <span class='kw'>=</span> <span class='st'>"failure time"</span>, <span class='kw'>ylab</span> <span class='kw'>=</span> <span class='st'>"survival function (OOB)"</span>,
        <span class='kw'>type</span> <span class='kw'>=</span> <span class='st'>"l"</span>, <span class='kw'>lty</span> <span class='kw'>=</span> <span class='fl'>1</span>)</div><div class='input'>
<span class='co'># Train the forest on a less granular grid.</span>
<span class='no'>failure.summary</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span>(<span class='no'>Y</span>[<span class='no'>D</span> <span class='kw'>==</span> <span class='fl'>1</span>])
<span class='no'>events</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq</a></span>(<span class='no'>failure.summary</span>[<span class='st'>"Min."</span>], <span class='no'>failure.summary</span>[<span class='st'>"Max."</span>], <span class='kw'>by</span> <span class='kw'>=</span> <span class='fl'>0.1</span>)
<span class='no'>s.forest.grid</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='survival_forest.html'>survival_forest</a></span>(<span class='no'>X</span>, <span class='no'>Y</span>, <span class='no'>D</span>, <span class='kw'>failure.times</span> <span class='kw'>=</span> <span class='no'>events</span>)
<span class='no'>s.pred.grid</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/predict.html'>predict</a></span>(<span class='no'>s.forest.grid</span>)
<span class='fu'><a href='https://rdrr.io/r/graphics/matplot.html'>matpoints</a></span>(<span class='no'>s.pred.grid</span>$<span class='no'>failure.times</span>, <span class='fu'><a href='https://rdrr.io/r/base/t.html'>t</a></span>(<span class='no'>s.pred.grid</span>$<span class='no'>predictions</span>[<span class='fl'>1</span>:<span class='fl'>5</span>, ]),
          <span class='kw'>type</span> <span class='kw'>=</span> <span class='st'>"l"</span>, <span class='kw'>lty</span> <span class='kw'>=</span> <span class='fl'>2</span>)</div><div class='img'><img src='predict.survival_forest-2.png' alt='' width='700' height='433' /></div><div class='input'>
<span class='co'># Compute OOB concordance based on the mortality score in Ishwaran et al. (2008).</span>
<span class='no'>s.pred.nelson.aalen</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/predict.html'>predict</a></span>(<span class='no'>s.forest</span>, <span class='kw'>prediction.type</span> <span class='kw'>=</span> <span class='st'>"Nelson-Aalen"</span>)
<span class='no'>chf.score</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/colSums.html'>rowSums</a></span>(-<span class='fu'><a href='https://rdrr.io/r/base/Log.html'>log</a></span>(<span class='no'>s.pred.nelson.aalen</span>$<span class='no'>predictions</span>))
<span class='kw'>if</span> (<span class='fu'><a href='https://rdrr.io/r/base/library.html'>require</a></span>(<span class='st'>"survival"</span>, <span class='kw'>quietly</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>)) {
 <span class='fu'><a href='https://rdrr.io/pkg/survival/man/concordance.html'>concordance</a></span>(<span class='fu'><a href='https://rdrr.io/pkg/survival/man/Surv.html'>Surv</a></span>(<span class='no'>Y</span>, <span class='no'>D</span>) ~ <span class='no'>chf.score</span>, <span class='kw'>reverse</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>)
}</div><div class='output co'>#&gt; Call:
#&gt; concordance.formula(object = Surv(Y, D) ~ chf.score, reverse = TRUE)
#&gt; 
#&gt; n= 2000 
#&gt; Concordance= 0.6185 se= 0.008735
#&gt; concordant discordant     tied.x     tied.y    tied.xy 
#&gt;     845962     521809          0          0          0 </div><div class='input'># }

</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Julie Tibshirani, Susan Athey, Erik Sverdrup, Stefan Wager.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


